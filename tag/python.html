<?xml version="1.0" encoding="utf-8"?>
<!doctype html>
<html lang="en">
    <head>
        <title>Signal <small>Python</small></title>

        <!-- meta -->
        <meta charset="utf-8" />
        <meta name="author" content="importcjj" />

        <!-- Feeds -->

        <!-- Style -->
        <link href="https://fonts.googleapis.com/css?family=Linden+Hill:400,400italic" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="https://importcjj.github.io/theme/css/main.css" type="text/css" />
        <link rel="shortcut icon" href="https://importcjj.github.io/theme/favicon.ico" />

        <!-- Google analytics -->

    </head>
    <body>
        <div id="wrapper">
          <div id="blogtitle">
            <a href="https://importcjj.github.io/">Signal</a>
         </div>

          <!-- Blogroll -->
          <ul id="mainnav">
            <li><a href="http://chihiro.moe">Slade</a></li>
            <li><a href="http://shenyizhou.github.io">无主之地</a></li>
            <li><a href="http://yuan0.github.io">Junifer</a></li>
            <li><a href="http://getpelican.com/">Pelican</a></li>
            <li><a href="http://python.org/">Python.org</a></li>
            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
            <li><a href="http://dongweiming.github.io/Expert-Python/#1">Expert-python</a></li>
          </ul>

          <div class="clearboth"></div>
          <div id="content">
<section id="content">


  <div class="row">
    <div class=article-overview>
      <div class=date>日 27 三月 2016</div>
      <div class=detail>
        <h1><a href="https://importcjj.github.io/python-yieldxiao-ji.html" title="Permalink to Python yield小记">Python yield小记</a></h1>
        <div class=summary><h4>yeild</h4>
<p><em>yield</em> 一般搭配函数来定义一个Generator(生成器)</p>
<p>一个简单的例子:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="k">print</span> <span class="s2">&quot;Today is 7.21&quot;</span>
    <span class="k">yield</span> <span class="mi">6</span>
</pre></div>


<p><em>f()</em> 将会返回一个Generator, 而非像普通函数一样执行。想要使用生成器的话(比如 i)需要使用i.next() (与next(i)等效) 和i.send(value)。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">f</span> <span class="n">at</span> <span class="mh">0x1041e7dc0</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="n">Today</span> <span class="ow">is</span> <span class="mf">7.21</span>
<span class="mi">6</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last ...</span></pre></div></div>
      </div>

      <!-- tags list -->
	  <div class="tags">
        <a class="tag" href="https://importcjj.github.io/tag/yield.html">yield</a>
        <a class="tag" href="https://importcjj.github.io/tag/sheng-cheng-qi.html">生成器</a>
        <a class="tag" href="https://importcjj.github.io/tag/python.html">Python</a>
      </div>
    </div>
    <div class=article-overview>
      <div class=date>日 27 三月 2016</div>
      <div class=detail>
        <h1><a href="https://importcjj.github.io/pythonzhong-yi-xie-rong-yi-bei-hu-shi-de-dong-xi.html" title="Permalink to Python中一些容易被忽视的东西">Python中一些容易被忽视的东西</a></h1>
        <div class=summary><h3>旨在记录Python标准库中好像很厉害的模块或功能。</h3>
<h5>1. <a href="#particial">functools.partial(func[,<em>args][, </em>*keywords])</a></h5>
<h5>2. <a href="#globals_and_locals">globals() and locals()</a></h5>
<h4><a id="particial">functools.partial(func[,<em>args][, </em>*keywords])</a></h4>
<p>为func的参数指定默认值后返回一个新的函数。比如:</p>
<div class="highlight"><pre><span></span><span class="c1"># disable print as the statement</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="k">print</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="k">print</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;This will print to f)</span>
<span class="c1"># stdout ...</span></pre></div></div>
      </div>

      <!-- tags list -->
	  <div class="tags">
        <a class="tag" href="https://importcjj.github.io/tag/python.html">Python</a>
      </div>
    </div>
    <div class=article-overview>
      <div class=date>日 27 三月 2016</div>
      <div class=detail>
        <h1><a href="https://importcjj.github.io/shi-yong-pythonzhi-zuo-zi-ding-yi-zhong-duan-ming-ling.html" title="Permalink to 使用Python制作自定义终端命令">使用Python制作自定义终端命令</a></h1>
        <div class=summary><h3>介绍</h3>
<p>首先，拿pip举个例子，pip是我们使用较多的python包管理工具。当我们安装pip之后，直接在终端中就可以使用pip这个命令。那你有没有想过这是如何实现的？</p>
<p>其实，pip这个命令最终调用了python所在文件夹bin目录的pip文件。为什么说最终？因为使用系统默认的python安装pip时，可能会在/usr/local/bin或者/usr/bin下创建软链接。如果使用了virtualenv，那么pip文件就在env/bin下。那么pip文件到底是什么呢？答案就是，是一个具有执行权限的python文件，只不过去掉了.py的后缀.</p>
<p>也许你会兴高采烈的去尝试一发，在bin文件下创建xxx.py，打上一句 print “hello world”, 然后去掉.py的后缀, 再使用chmod a+x xxx来赋予它执行的权限。打开终端，敲下xxx。最后你只会得到print: command not found的错误提示。为什么？因为操作系统不知道这是一个py文件。思考一下，我们平时运行py文件都需要打上python xxx.py形式的命令 ...</p></div>
      </div>

      <!-- tags list -->
	  <div class="tags">
        <a class="tag" href="https://importcjj.github.io/tag/python.html">Python</a>
      </div>
    </div>
    <div class=article-overview>
      <div class=date>日 27 三月 2016</div>
      <div class=detail>
        <h1><a href="https://importcjj.github.io/supervisorcelerycelerybeatde-jian-dan-shi-yong.html" title="Permalink to supervisor+celery+celerybeat的简单使用">supervisor+celery+celerybeat的简单使用</a></h1>
        <div class=summary><h2>1. 提前准备</h2>
<p>略去相关工具的安装过程，其实都挺简单的!</p>
<p>celery作为异步任务队列, 需要一个中间人来协助celery存放和消耗任务信息。我们选择rabbitmq来做消息代理人。使用celery之前, 需要使用创建一个rabbitmq的管理员账号和一个能让该账号访问的vhost.</p>
<p><strong><a href="">Rabbitmq的安装配置以及网页管理插件</a></strong></p>
<p>假设准备的rabbitmq的信息如下:</p>
<div class="highlight"><pre><span></span><span class="n">SETTINGS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;www-data&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;www-data&#39;</span><span class="p">,</span>
    <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="s1">&#39;5672&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vhost&#39;</span><span class="p">:</span> <span class="s1">&#39;t_celery&#39;</span>
<span class="p">}</span>
</pre></div>


<h3>示例项目结构</h3>
<div class="highlight"><pre><span></span><span class="n">test</span><span class="p">.</span><span class="n">celery</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">env</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">src</span><span class="o">/</span>
        <span class="o">|-</span> <span class="n">__init__</span><span class="p">.</span><span class="n">py</span>
        <span class="o">|-</span> <span class="n">app</span><span class="p">.</span><span class="n">py</span>
        <span class="o">|-</span> <span class="n">task</span><span class="p">.</span><span class="n">py</span>
</pre></div>


<h2>2. celery实例及任务</h2>
<h3>2.1 生成实例</h3>
<div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># filename: app.py</span>

<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery ...</span></pre></div></div>
      </div>

      <!-- tags list -->
	  <div class="tags">
        <a class="tag" href="https://importcjj.github.io/tag/supervisor.html">supervisor</a>
        <a class="tag" href="https://importcjj.github.io/tag/celery.html">celery</a>
        <a class="tag" href="https://importcjj.github.io/tag/python.html">Python</a>
      </div>
    </div>
    <div class=article-overview>
      <div class=date>日 27 三月 2016</div>
      <div class=detail>
        <h1><a href="https://importcjj.github.io/zhong-duan-jin-du-tiao-de-jian-dan-yuan-li.html" title="Permalink to 终端进度条的简单原理">终端进度条的简单原理</a></h1>
        <div class=summary><h4>进度条</h4>
<p>每次使用pip安装一些第三方库时，总会在终端或者命令行中看到进度条，能够让用户等待时得到当前任务的进度。今天偶然在知乎看到一个帖子中提到了这个有趣的功能。</p>
<h4>实现方式</h4>
<p>一般情况下命令行和终端的输出总是由上往下一行一行输出。如果我们需要实现进度条的效果的效果的话，就需要每次输出都在同一行上，不断地用后来的输出去覆盖之前的输出，从而模拟出一种动态变化的效果。那究竟怎样实现呢？答案就是使用<strong>反杠r</strong>。</p>
<p><strong>反杠n</strong>是换行，<strong>反杠r</strong>就只是把输出光标移到行首，而不换行。根据这个思路，我们先做个倒计时来玩玩。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">CountDown</span><span class="p">(</span><span class="n">total_sec</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># 不能换行哈</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%4d</span><span class="se">\\</span><span class="s1">r&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># 防止输出被之后的输出覆盖</span>
    <span class="k">print</span>

<span class="n">CountDown</span><span class="p">(</span><span class="mi">10 ...</span></pre></div></div>
      </div>

      <!-- tags list -->
	  <div class="tags">
        <a class="tag" href="https://importcjj.github.io/tag/python.html">Python</a>
      </div>
    </div>
    <div class=article-overview>
      <div class=date>六 26 三月 2016</div>
      <div class=detail>
        <h1><a href="https://importcjj.github.io/pythondan-ceng-zhuang-shi-qi-xiao-ji.html" title="Permalink to Python单层装饰器小记">Python单层装饰器小记</a></h1>
        <div class=summary><h4>解释器什么时候处理装饰器？</h4>
<p>答: Python解释器加载代码的时候.</p>
<p>例如, sleep.py 代码如下</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;handle decorator&quot;</span><span class="p">)</span>

    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">rtn</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;cost </span><span class="si">%f</span><span class="s2"> s&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">cost</span>
        <span class="k">return</span> <span class="n">rtn</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@timer</span>
<span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep ...</span></pre></div></div>
      </div>

      <!-- tags list -->
	  <div class="tags">
        <a class="tag" href="https://importcjj.github.io/tag/zhuang-shi-qi.html">装饰器</a>
        <a class="tag" href="https://importcjj.github.io/tag/python.html">Python</a>
      </div>
    </div>
    <div class=article-overview>
      <div class=date>六 26 三月 2016</div>
      <div class=detail>
        <h1><a href="https://importcjj.github.io/pythonde-metaclassxiao-ji.html" title="Permalink to Python的metaclass小记">Python的metaclass小记</a></h1>
        <div class=summary><p>使用metaclass的时候可以使用<strong>metaclass</strong>的<code>__new__</code>和<code>__init__</code>去改变所定义的类的相关属性，因为这两个方法是在类定义的时候被调用，他们所需的参数也与使用<code>type(name, bases, dict)</code>动态声明类相同。而使用<strong>metaclass</strong>的<code>__call__</code>可以影响我们所声明的类产生实例的过程，因为当我们使用class_name()去产生实例的时候，相当于call了这个class，而这个class又是metaclass的实例，所以其实调用了metaclass的__call__</p>
<p>注意: 通过<code>super</code>来调用父类的<code>__new__</code>时，第一个参数需要是该class，这点是不同于调用<code>__init__</code>等其他父类方法的。因为<code>__new__</code>是个静态方法。还有一个小问题就是当父类是object的时候，也就是调用<code>object.__new__()</code>只传一个cls参数就可以了，至于为什么，请戳<a href="https://mail.python.org/pipermail/python-dev/2008-February/076854.html">here</a>
和<a href="http://bugs.python.org/issue1683368">here</a>。 如果你重写了<code>__new__</code>而没有重写 ...</p></div>
      </div>

      <!-- tags list -->
	  <div class="tags">
        <a class="tag" href="https://importcjj.github.io/tag/metaclass.html">metaclass</a>
        <a class="tag" href="https://importcjj.github.io/tag/python.html">Python</a>
      </div>
    </div>
    <div class=article-overview>
      <div class=date>六 26 三月 2016</div>
      <div class=detail>
        <h1><a href="https://importcjj.github.io/sheng-ji-centosde-pythonban-ben.html" title="Permalink to 升级CentOS的Python版本">升级CentOS的Python版本</a></h1>
        <div class=summary><p>服务器(centos)上默认的python版本是python2.6，但是平时使用的是2.7，故手动升级一下吧。</p>
<p>下载最新版本<a href="https://www.python.org/ftp/python/2.7.10/Python-2.7.10.tgz">Python-2.7.10</a></p>
<div class="highlight"><pre><span></span>wget https://www.python.org/ftp/python/2.7.10/Python-2.7.10.tgz

tar -zxvf Python-2.7.10.tgz
</pre></div>


<p>提前安装依赖</p>
<div class="highlight"><pre><span></span>yum install zlib
yum install zlib-devel
yum install openssl -y
yum install openssl-devel -y
</pre></div>


<p>配置编译安装替换</p>
<div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">Python</span><span class="o">-</span><span class="mi">2 ...</span></pre></div></div>
      </div>

      <!-- tags list -->
	  <div class="tags">
        <a class="tag" href="https://importcjj.github.io/tag/centos.html">CentOS</a>
        <a class="tag" href="https://importcjj.github.io/tag/python.html">Python</a>
        <a class="tag" href="https://importcjj.github.io/tag/yun-wei.html">运维</a>
      </div>
    </div>
  </div><!-- /.row -->

</section><!-- /#content -->
          </div>
        </div>

        <!-- footer -->
        <div class=footer>
          <div class="textwidget">
















          </div>

          <p>
            Carburize with <a href="http://blog.getpelican.com">pelican</a></p>
          <p><a href="https://github.com/badele/pelican-theme-jesuislibre">jesuislibre</a> theme, inspired by <a href="http://blog.dbrgn.ch">dbrng</a> blog</p>
          <p><a href="http://bruno.adele.im">about author</a></p>
      </div>


     </body>
</html>