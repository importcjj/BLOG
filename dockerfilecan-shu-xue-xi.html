<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width">
        <title>Dockerfile参数学习</title>
        <link rel="stylesheet" href="https://importcjj.github.io/theme/css/main.css" />
        <script type="text/javascript" src="https://importcjj.github.io/theme/js/jquery-1.12.3.min.js"></script>

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<!-- <a href="https://github.com/importcjj">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
 -->
        <input id="header-toggle" type="checkbox">
        <header id="banner" class="body">
                <h1><a href="https://importcjj.github.io/">Signal </a></h1>
                <nav><ul>
                    <li><a href="https://importcjj.github.io/category/centos.html">CentOS</a></li>
                    <li class="active"><a href="https://importcjj.github.io/category/docker.html">Docker</a></li>
                    <li><a href="https://importcjj.github.io/category/emacs.html">Emacs</a></li>
                    <li><a href="https://importcjj.github.io/category/git.html">git</a></li>
                    <li><a href="https://importcjj.github.io/category/github.html">github</a></li>
                    <li><a href="https://importcjj.github.io/category/go.html">Go</a></li>
                    <li><a href="https://importcjj.github.io/category/markdown.html">Markdown</a></li>
                    <li><a href="https://importcjj.github.io/category/python.html">Python</a></li>
                    <li><a href="https://importcjj.github.io/category/sundry.html">sundry</a></li>
                    <li><a href="https://importcjj.github.io/category/tool.html">Tool</a></li>
                </ul></nav>
        </header><!-- /#banner -->
        <aside class="side-bar">
            <ul>
                <li><a href="https://importcjj.github.io/"><i class="fa fa-info fa-lg"></i></a></li>
                <li><a href="https://importcjj.github.io/categories.html"><i class="fa fa-book fa-lg"></i></a></li>
                <li><a href="https://importcjj.github.io/archives.html"><i class="fa fa-archive fa-lg"></i></a></li>
                <li><a href="https://importcjj.github.io/tags.html"><i class="fa fa-tags fa-lg"></i></a></li>
                <li><a href="https://importcjj.github.io/authors.html"><i class="fa fa-users fa-lg"></i></a></li>
<li><a href="https://github.com/importcjj"><i class="fa fa-github fa-lg"></i></a></li>            </ul>
        </aside>
        <div class="tool-btns">
            <label id="header-toggle-btn" class='tool-btn' for="header-toggle"><i class="fa fa-bars"></i></label>
            <label id="back-to-top" class="tool-btn"><i class="fa fa-arrow-up"></i></label>
        </div>
        <div class="content">
<section id="content" class="body">
  <article>
    <div>
    </div>

    <div class="entry-content markdown-body markdown">
<footer class="post-info">
        <div class="meta">
        <a class="category" href="https://importcjj.github.io/category/docker.html">Docker</a>
        <address class="vcard author">
                        <a class="url fn" href="https://importcjj.github.io/author/importcjj.html">importcjj</a>
        </address>
        <abbr class="published" title="2016-03-27T03:37:03+08:00">
                · 27 三月 2016
        </abbr>
        </div>
        <h1 class="entry-title"><a href="https://importcjj.github.io/dockerfilecan-shu-xue-xi.html">Dockerfile参数学习</a></h1>
<p class="tags"><a><i class="fa fa-tags"></i> </a><a href="https://importcjj.github.io/tag/docker.html">Docker</a> <a href="https://importcjj.github.io/tag/dockerfile.html">Dockerfile</a> </p>
</footer><!-- /.post-info -->      <div class="post-body"> <h4>镜像和容器</h4>
<p>容器是镜像的实例。一个镜像可以对应多个容器。每次使用<code>docker run &lt;image&gt;</code>时都会重新创建该镜像的一个容器，我们可以为该命令指定--name <name>来为所产生的容器指定名字:</p>
<p><code>docker run -d --name serve ubuntu</code> 这样根据ubuntu这个镜像产生的容器就叫<em>serve</em>。</p>
<p>。当容器运行时，我们对容器的修改只会写人到容器的文件系统，而不会影响到对应镜像。所以， 前一次run形成的改动不会影响到后一次run所创建的容器。想要这些修改对image生效， 可以使用<code>docker commit &lt;container&gt;</code></p>
<div class="highlight"><pre><span></span>                <span class="err">├─</span> <span class="err">可写层</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
<span class="err">内核层</span> <span class="o">-</span> <span class="err">镜像层</span> <span class="err">─</span> <span class="err">├─</span> <span class="err">可写层</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
                <span class="err">├─</span> <span class="err">可写层</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
</pre></div>


<p><strong>内核层 - 镜像层 -可写层(container)</strong></p>
<h4>CMD和ENTRYPOINT的区别</h4>
<p>首先两者都可以让你在容器运行的时候执行一条命令，而且这两个字段在Dockerfile中只能指定一次，如果指定多次，那么则以最后一次为准。</p>
<p>再来说两者的区别: 假如我们在运行容器的命令<code>docker run &lt;image&gt;</code>中指定了参数。那么CMD指定的命令会被该参数所覆盖, 但是该参数却能为ENTRYPOINT中指定的命令所用。</p>
<p>举个例子:</p>
<div class="highlight"><pre><span></span><span class="c"># Dockerfile</span>
<span class="c"># 镜像名: test</span>
...
<span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello, CMD!&quot;</span><span class="p">]</span>
</pre></div>


<p>当我们使用<code>docker run test</code>时，显示<code>Hello, CMD!</code>，但当我们使用<code>docker run test echo hi, everyone!</code>时， 显示<code>hi, everyone!</code>。我们重新指定的echo命令和参数覆盖了原来的echo。 值得注意的是，如果在Dockerfile使用CMD指定命令, 那么在run的时候指定的第一个参数必须时可执行的命令，否则将运行失败！</p>
<p>如果我们使用ENTRYPOINT指定入口命令的话，在docker run命令中指定的参数都会被传递给入口命令.</p>
<div class="highlight"><pre><span></span><span class="c"># Dockerfile</span>
<span class="c"># 镜像名: test</span>
...
<span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello, CMD!&quot;</span><span class="p">]</span>
</pre></div>


<p>运行<code>docker run test echo hi, everyone!</code>将得到<code>Hello, CMD! echo hi, everyone!</code></p>
<p>补充:</p>
<p>其实在<code>run</code>的时候<code>ENTRYPOINT</code>也是可以别覆盖的，通过指定<code>--entrypoint="xxxx"</code>参数就可以做到!</p>
<h4>FROM</h4>
<p>指定基础镜像，格式通常为<code>FROM &lt;image&gt;:&lt;tag&gt;</code> 例如:
<code>From ubuntu:latest</code>
如果本地不存在该镜像，则去Docker Hub中拉取该镜像。</p>
<h4>MAINTAINER</h4>
<p>为该镜像指定作者, 例如:
<code>MAINTAINER importcjj@ele.me</code></p>
<h4>ENV</h4>
<p>设定环境变量， 两种方式:
<em> ENV \<key> \<value>
</em> ENV \<key>=\<value></p>
<p>例如:
<em> ENV LANG en_US.UTF-8
</em> ENV PYTHON_VERSION 2.7.6</p>
<h4>WORKDIR</h4>
<p>切换工作目录，类似于cd， 例如:</p>
<div class="highlight"><pre><span></span><span class="c"># pwd is /p/dir1</span>
<span class="k">RUN</span> ls
<span class="c"># now cd to /p/dir2</span>
<span class="k">WORKDIR</span><span class="s"> ../dir2</span>
<span class="c"># pwd is /p/dir2</span>
<span class="k">RUN</span> ls
</pre></div>


<h4>RUN</h4>
<p>可用于运行普通的命令，有两种方式:
<em> RUN \<command>
</em> RUN ["executable", "param1", "param2"]</p>
<p><strong>通常使用第一种</strong></p>
<p>比如运行相关软件包的安装命令，例如:
<em> RUN apt-get -y update
</em> RUN apt-get -y python
<em> RUN apt-get install -y python-pip
</em> RUN apt-get install -y python2.7-dev
* RUN pip install flask</p>
<h4>ADD</h4>
<p>将build路径(或者相对位置)的文件，文件夹甚至是远程文件添加至荣区的文件系统的指定位置，可用于设置相关软件的配置文件等例如:</p>
<div class="highlight"><pre><span></span><span class="k">ADD</span> requirements.txt /tmp/requirements.txt
<span class="k">RUN</span> pip install -i /tmp/requirements.txt
</pre></div>


<h4>VOLUME</h4>
<p>将宿主系统的文件夹挂载到容器中指定的文件夹。比如:</p>
<div class="highlight"><pre><span></span><span class="k">VOLUME</span><span class="s"> /data/logs</span>
</pre></div>


<p>此命令的局限性在于无法指定宿主系统的某个文件夹被挂载，只能由docker来分配。可用docker run的<code>-v src:dest</code>参数来弥补这一局限性。如果想要查看是哪个文件夹被mount了，使用<code>docker inspect &lt;container&gt;</code>，在返回的json结果中的查看<strong>Mounts</strong>这个字段的内容。</p>
<h4>EXPOSE</h4>
<p>指定容器运行时所要监听的端口。虽然配置了EXPOSE, 但我们在运行容器的时候还需要指定端口映射，否则在宿主机中无法访问该端口。 例如:
<code>docker run -d -p 127.0.0.1:5000:5000</code>
这样的话我们容器的5000端口就被映射到了宿主机的5000端口。访问宿主机的5000端口，即可访问到容器的5000端口所提供的服务。
同时，多端口的映射也是可以的 <code>-p 1234-1236:1234-1236/tcp</code></p>
<h4>LABEL</h4>
<p>为构建的镜像设置标签
<code>LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt;</code>
设置的标签可在 <code>docker inspect &lt;image&gt;</code>给出的JSON结果中看到。</p>
<h4>例子(来源于github)</h4>
<div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> centos:centos6</span>

<span class="k">RUN</span> cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
<span class="k">RUN</span> yum install -y wget tar gcc zlib zlib-devel openssl openssl-devel unzip mysql-devel python-devel

<span class="k">RUN</span> mkdir /opt/logs
<span class="k">RUN</span> mkdir /usr/src/python
<span class="k">WORKDIR</span><span class="s"> /usr/src/python</span>

<span class="k">ENV</span> LANG en_US.UTF-8
<span class="k">ENV</span> PYTHON_VERSION <span class="m">2</span>.7.6

<span class="k">RUN</span> curl -SL <span class="s2">&quot;https://www.python.org/ftp/python/</span><span class="nv">$PYTHON_VERSION</span><span class="s2">/Python-</span><span class="nv">$PYTHON_VERSION</span><span class="s2">.tgz&quot;</span> <span class="p">|</span> tar xvzf - --strip-components<span class="o">=</span><span class="m">1</span>
<span class="k">RUN</span> ./configure <span class="se">\</span>
    <span class="o">&amp;&amp;</span> make <span class="se">\</span>
    <span class="o">&amp;&amp;</span> make install <span class="se">\</span>
    <span class="o">&amp;&amp;</span> make clean

<span class="k">RUN</span> sed <span class="s1">&#39;s/\/usr\/bin\/python/\/usr\/bin\/python2.6/g&#39;</span> /usr/bin/yum &gt; /usr/bin/yum.tmp <span class="se">\</span>
    <span class="o">&amp;&amp;</span> mv /usr/bin/yum.tmp /usr/bin/yum <span class="se">\</span>
    <span class="o">&amp;&amp;</span> chmod <span class="m">755</span>  /usr/bin/yum

<span class="k">ADD</span> . /opt/
<span class="k">WORKDIR</span><span class="s"> /opt</span>

<span class="k">RUN</span> tar zxvf scribed.tar.gz <span class="se">\</span>
    <span class="o">&amp;&amp;</span> chown -R root:root scribed <span class="se">\</span>
    <span class="o">&amp;&amp;</span> rm -f scribed.tar.gz

<span class="k">RUN</span> curl -SL <span class="s1">&#39;https://bootstrap.pypa.io/get-pip.py&#39;</span> <span class="p">|</span> python
<span class="k">RUN</span> pip install -r requirements.txt <span class="se">\</span>
    <span class="o">&amp;&amp;</span> rm -f requirements.txt

<span class="k">RUN</span> easy_install virtualenv <span class="se">\</span>
    <span class="o">&amp;&amp;</span> easy_install mysql-connector-python <span class="se">\</span>
    <span class="o">&amp;&amp;</span> easy_install MySQL-python

<span class="k">RUN</span> easy_install supervisor <span class="se">\</span>
    <span class="o">&amp;&amp;</span> echo_supervisord_conf &gt; /etc/supervisord.conf <span class="se">\</span>
    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;[include]&quot;</span> &gt;&gt; /etc/supervisord.conf <span class="se">\</span>
    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;files = /etc/supervisord.d/*.conf&quot;</span> &gt;&gt; /etc/supervisord.conf <span class="se">\</span>
    <span class="o">&amp;&amp;</span> mkdir -p /etc/supervisord.d <span class="se">\</span>
    <span class="o">&amp;&amp;</span> cp gunicorn.conf scribed.conf /etc/supervisord.d/ <span class="se">\</span>
    <span class="o">&amp;&amp;</span> rm -f gunicorn.conf scribed.conf Dockerfile
</pre></div>


<h4>更多内容请前往<a href="https://docs.docker.com/engine/reference/builder/">Docker的官方文档</a></h4>
<h4>补充</h4>
<p>除了<code>FROM</code>, <code>MAINTAINER</code>, 'RUN' 和 'AND<code>四个Dockerfile命令之外, 其他命令都可以在</code>docker run`时被覆盖! 详见Docker官方文档<a href="https://docs.docker.com/engine/reference/run/">docker run reference</a>。</p>
<p>修改Dockerfile的时候，尽量在文件的最后修改(如果允许的话)。这回加快build的速度(缓存的作用：)。因此, 尽量把不轻易变动的部分放在Dockerfile的上方。</p>
<p>如何为正在运行的容器，打开一个新的shell？
<em> <code>docker exec -i -t &lt;container_id&gt; bash</code>
</em> <code>docker exec -i -t &lt;container_name&gt; bash</code></p> </div>
    </div><!-- /.entry-content -->
    <p class="copyright">©版权所有, 转载请注明出处</p>
    <div class="comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'importcjj';
        var disqus_identifier = 'dockerfilecan-shu-xue-xi.html';
        var disqus_url = 'https://importcjj.github.io/dockerfilecan-shu-xue-xi.html';
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//importcjj.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>

  </article>
</section>
        <section id="extras" class="body animated" style="opacity: 0">
                <div class="blogroll">
                        <h2>Links</h2>
                        <ul>
                            <li>
                                <a class="link-name" href="http://chihiro.moe">Slade</a>
                                <a class="link-href">http://chihiro.moe</a>
                            </li>
                            <li>
                                <a class="link-name" href="http://shenyizhou.github.io">无主之地</a>
                                <a class="link-href">http://shenyizhou.github.io</a>
                            </li>
                            <li>
                                <a class="link-name" href="http://yuan0.github.io">Junifer</a>
                                <a class="link-href">http://yuan0.github.io</a>
                            </li>
                            <li>
                                <a class="link-name" href="http://getpelican.com/">Pelican</a>
                                <a class="link-href">http://getpelican.com/</a>
                            </li>
                            <li>
                                <a class="link-name" href="http://python.org/">Python.org</a>
                                <a class="link-href">http://python.org/</a>
                            </li>
                            <li>
                                <a class="link-name" href="http://jinja.pocoo.org/">Jinja2</a>
                                <a class="link-href">http://jinja.pocoo.org/</a>
                            </li>
                            <li>
                                <a class="link-name" href="http://dongweiming.github.io/Expert-Python/#1">Expert-python</a>
                                <a class="link-href">http://dongweiming.github.io/Expert-Python/#1</a>
                            </li>
                        </ul>
                </div><!-- /.blogroll -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body animated" style="opacity: 0">
                <p>Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </p><!-- /#about -->
                <p>The theme is by <a href="https://github.com/importcjj/yake">importcjj</a>, thanks!</p>
                <p>托管于 <a href="https://github.com">github</a> 和 <a href="https://coding.net/">coding</a>,  
                并借助 <a href="https://travis-ci.com/">travis ci</a> 完成自动编译发布.
                </p>
                <img src="https://travis-ci.org/importcjj/importcjj.github.io.svg?branch=master"/>
        </footer><!-- /#contentinfo -->
        </div>

<script type="text/javascript">
// index animate
$('.animated').map(function(i, node) {
    var timeout = (i + 1) * 270;
    console.log(timeout);
    setTimeout(function(){
        $(node).addClass('fadeInLeft');
        $(node).css('opacity', 1);
    }, timeout);
}.bind(this));


// back to page top
(function() {
    // var $ = function(id) {return document.getElementById(id)};
    // var scrollTop = function() {return document.documentElement.scrollTop || document.body.scrollTop};
    // var backToTop = function() {
    //     var fromTop = scrollTop();
    //     if(fromTop){
    //         window.scrollBy(0, -40);
    //         window.timeout = setTimeout(backToTop, 5);
    //     } else{
    //         clearTimeout(window.timeout);
    //     }
    // };

    // $('back-to-top').onclick = function(evt) {backToTop()};
    $('#back-to-top').click(function() {
        $('body').animate({'scrollTop': 0}, 800);
    });

    window.onscroll = function(evt) {
        if($('body').scrollTop() > 500) {
            $('#back-to-top').css('display','block');
        } else {
            $('#back-to-top').css('display', 'none');}
    };

}())
</script><script type="text/javascript">
    var disqus_shortname = 'importcjj';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>